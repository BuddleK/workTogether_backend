<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="adminCare">

	<!-- 대기 목록(페이징 전용) -->
	<select id="pendingListPaged" parameterType="map"
		resultType="com.wt.app.dto.AdminCareSignupDTO">
    <![CDATA[
      SELECT
        u.users_number, u.users_id, u.users_created_date, c.users_name,
        c.users_email, c.users_phone, c.users_postsal_code, c.users_address_line1,
        c.users_address_line2, c.care_intro_text, c.care_certificate_files_num,
        c.care_passbook_files_num, c.care_profiles_photo_number, c.care_accept
      FROM tbl_care_users c
      JOIN tbl_users u 
      ON u.users_number = c.users_number
      WHERE c.care_accept = 'N'
      ORDER BY u.users_created_date DESC
      OFFSET #{offset} ROWS FETCH NEXT #{limit} ROWS ONLY
    ]]>
	</select>

	<!-- 대기 총 개수 -->
	<select id="pendingCount" resultType="int">
    <![CDATA[
      SELECT COUNT(*)
      FROM tbl_care_users c
      JOIN tbl_users u ON u.users_number = c.users_number
      WHERE c.care_accept = 'N'
    ]]>
	</select>

	<!-- 단건 조회 -->
	<select id="signupOne" parameterType="int"
		resultType="com.wt.app.dto.AdminCareSignupDTO">
    <![CDATA[
      SELECT
        u.users_number, u.users_id, u.users_created_date,
        c.users_name, c.users_email, c.users_phone,
        c.users_postsal_code, c.users_address_line1, c.users_address_line2,
        c.care_intro_text, c.care_certificate_files_num, c.care_passbook_files_num,
        c.care_profiles_photo_number, c.care_accept
      FROM tbl_care_users c
      JOIN tbl_users u
      ON u.users_number = c.users_number
      WHERE c.users_number = #{value}
    ]]>
	</select>

	<!-- 승인/반려 -->
	<update id="approve" parameterType="int">
    <![CDATA[
      UPDATE tbl_care_users
         SET care_accept = 'Y'
       WHERE users_number = #{value}
    ]]>
	</update>
	
	<!-- 이거 고민중 -->
	<delete id="rejectCare" parameterType="int">
    <![CDATA[
      DELETE FROM tbl_care_users
       WHERE users_number = #{value}
    ]]>
	</delete>

	<delete id="rejectAll" parameterType="int">
    <![CDATA[
      DELETE FROM tbl_users
       WHERE users_number = #{value}
    ]]>
	</delete>

	<!-- 자격증 파일 -->
	<select id="fileLicense" parameterType="int"
		resultType="com.wt.app.dto.AdminCareFileDTO">
    <![CDATA[
      SELECT
        license_files_number, license_files_type,
        license_files_name, license_files_path, license_files_size_bytes,
        TO_CHAR(license_created_date,'YYYY-MM-DD HH24:MI:SS') createdDate
      FROM tbl_files_license
      WHERE license_files_number = #{value}
    ]]>
	</select>

	<!-- 통장 사본 파일 -->
	<select id="fileAccount" parameterType="int"
		resultType="com.wt.app.dto.AdminCareFileDTO">
    <![CDATA[
      SELECT
        account_files_number, account_files_type, account_files_name,
        account_files_path, account_files_size_bytes,
        TO_CHAR(account_created_date,'YYYY-MM-DD HH24:MI:SS') createdDate
      FROM tbl_files_account
      WHERE account_files_number = #{value}
    ]]>
	</select>

	<!-- 프로필 파일 (경로 제외) -->
	<select id="fileProfile" parameterType="int"
		resultType="com.wt.app.dto.AdminCareFileDTO">
    <![CDATA[
      SELECT
        profiles_files_number, profiles_files_type,
        profiles_files_name, profiles_files_size_bytes,
        TO_CHAR(profiles_created_date,'YYYY-MM-DD HH24:MI:SS') createdDate
      FROM tbl_files_profiles
      WHERE profiles_files_number = #{value}
    ]]>
	</select>

	<!--Refund Table -->

	<!--History Modification -->


</mapper>