<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 후기 전체 조회 -->
<mapper namespace="commentsList">
	<select id="commentsListAll" resultType="CareCommentsDTO">
		<!-- <![CDATA[
			SELECT * FROM (
							SELECT ROWNUM AS rnum, subquery.*
							FROM (
								SELECT COMMENTS_NUMBER,
								nu.USERS_NAME, CARE_NUMBER, COMMENTS_CONTENT, COMMENTS_CREATED_DATE,
								COMMENTS_UPDATED_DATE
								FROM TBL_COMMENTS cm
								LEFT JOIN TBL_NORMAL_USERS nu
								ON cm.NORMAL_NUMBER = nu.NORMAL_NUMBER
								WHERE cm.CARE_NUMBER = #{careNumber}
								) subquery
							) WHERE rnum BETWEEN #{startRow} AND #{endRow}	
		]]> -->
		
		SELECT COMMENTS_NUMBER,
		nu.USERS_NAME, CARE_NUMBER, COMMENTS_CONTENT, COMMENTS_CREATED_DATE,
		COMMENTS_UPDATED_DATE
		FROM TBL_COMMENTS cm
		LEFT JOIN TBL_NORMAL_USERS nu
		ON cm.NORMAL_NUMBER = nu.NORMAL_NUMBER
		WHERE cm.CARE_NUMBER = #{careNumber}
	</select>
	
	<!-- 후기 전체 리스트 개수 -->
	<select id="commentsGetTotal">
		select count(comments_number) from tbl_comments
	</select>
	
	<insert id="commentsAdd" parameterType="CareCommentsDTO">
		insert into INSERT INTO RICEBALL.TBL_COMMENTS
		(COMMENTS_NUMBER, NORMAL_NUMBER, CARE_NUMBER, COMMENTS_CONTENT, COMMENTS_CREATED_DATE, COMMENTS_UPDATED_DATE)
		VALUES(seq_care_comment.nextval, #{normalNumber}, #{careNumber}, #{commentsContent}, sysdate, sysdate)
	</insert>

	<!-- 코멘트 수정 -->
	<update id="updateComments" parameterType="CareCommentsDTO">
		UPDATE tbl_comments
		SET COMMENTS_CONTENT = #{commentsContent}, COMMENTS_UPDATED_DATE =
		sysdate
		WHERE NORMAL_NUMBER = #{normalNumber}
	</update>

	<!-- 코멘트 삭제 -->
	<delete id="commentDelete" parameterType="int">
		delete from
		tbl_comments
		where
		normal_number =
		#{normalNumber}
	</delete>

</mapper>
	
