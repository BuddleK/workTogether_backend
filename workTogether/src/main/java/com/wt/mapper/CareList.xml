<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="careList">
	<!-- 돌봄회원 리스트 모음집 -->
	<!-- 프사, 이름, 날짜, 소개글, 간단지역 -->
	<select id="listExecptHeart" resultType="careListDTO">
		select u.users_number,
		c.users_name, c.users_address_line1, c.care_number, c.care_intro_text,
		c.care_profiles_photo_number,
		fp.profiles_files_number,
		fp.profiles_files_type, fp.profiles_files_name,
		fp.profiles_files_path,
		d.DAY_MONDAY, d.DAY_TUESDAY, d.DAY_WEDNESDAY,
		d.DAY_THURSDAY, d.DAY_FRIDAY,
		d.DAY_SATURDAY, d.DAY_SUNDAY
		from
		tbl_care_users c left join tbl_users u on c.users_number =
		u.users_number
		left join tbl_files_profiles fp on
		c.care_profiles_photo_number =
		fp.profiles_files_number
		left join
		tbl_day d on c.care_number = d.care_number
		LEFT OUTER JOIN tbl_day d ON
		c.CARE_NUMBER = d.CARE_NUMBER
	</select>

<!-- 리스트에 있는 하나하나 번호 조회 -->
	<select id="listNumber" resultType="int">
		select c.care_number
		from tbl_care_users c left join tbl_users u on c.users_number =
		u.users_number
		left join tbl_files_profiles fp on c.care_profiles_photo_number =
		fp.profiles_files_number
		left join tbl_day d on c.care_number = d.care_number
		LEFT OUTER JOIN tbl_day d ON c.CARE_NUMBER = d.CARE_NUMBER
	</select>
	
	<!-- 로그인한 유저가 하트를 누른 유저에 대한 유저의 번호 조회 -->
	<select id="listHeartNumber" resultType="int">
		SELECT HEARTS_CARE_NUMBER  FROM tbl_hearts WHERE HEARTS_NORMAL_NUMBER = #{userId}
	</select>
	
	
	<select id="list" resultType="CareListDTO">
		select u.users_number,
    	c.users_name, c.users_address_line1, c.care_number, c.care_intro_text, c.care_profiles_photo_number,
    	fp.profiles_files_number, fp.profiles_files_type, fp.profiles_files_name, fp.profiles_files_path,
    	d.DAY_MONDAY, d.DAY_TUESDAY, d.DAY_WEDNESDAY, d.DAY_THURSDAY, d.DAY_FRIDAY, d.DAY_SATURDAY, d.DAY_SUNDAY,
    	CASE  WHEN h.HEARTS_CARE_NUMBER IS NOT NULL THEN 'Y' ELSE 'N' END AS heart_checked
		FROM tbl_care_users c
		LEFT JOIN tbl_users u ON c.users_number = u.users_number
		LEFT JOIN tbl_files_profiles fp ON c.care_profiles_photo_number = fp.profiles_files_number
		LEFT JOIN tbl_day d ON c.care_number = d.care_number
		LEFT JOIN tbl_hearts h ON c.care_number = h.HEARTS_CARE_NUMBER AND h.HEARTS_NORMAL_NUMBER = #{userId}
		WHERE c.CARE_ACCEPT = 'Y'
		ORDER BY c.care_number
	</select>
	
	<select id="detail" resultType="CareListDTO">
		SELECT c.care_number, c.users_name, c.CARE_INTRO_TEXT, d.DAY_MONDAY, d.DAY_TUESDAY, d.DAY_WEDNESDAY, d.DAY_THURSDAY, d.DAY_FRIDAY, d.DAY_SATURDAY, d.DAY_SUNDAY
		FROM TBL_CARE_USERS c 
		LEFT JOIN TBL_DAY d ON c.CARE_NUMBER = d.CARE_NUMBER
		WHERE c.CARE_ACCEPT = 'Y';
	</select>
	
	<select id="detailComments" resultType="CareCommentsDTO">
		SELECT COMMENTS_NUMBER, nu.USERS_NAME, CARE_NUMBER, COMMENTS_CONTENT, COMMENTS_CREATED_DATE, COMMENTS_UPDATED_DATE
		FROM TBL_COMMENTS cm
		LEFT JOIN TBL_NORMAL_USERS nu ON cm.NORMAL_NUMBER = nu.NORMAL_NUMBER
		WHERE cm.CARE_NUMBER = #{careNumber}
	</select>

</mapper>



