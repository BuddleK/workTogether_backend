<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="shops">
	<!-- 가게 리스트 페이지 -->
	<select id="list" parameterType="shopsDTO">
		select shops_number,shops_branch_name,shops_road_address, shops_admin_dong, shops_phone, shops_working_hours,
		case when f.favorites_number is not null then 'Y' else 'N' end as 'is_favorite',
		from tbl_shops s left join tbl_shop_favorites f on s.shops_number = f.favorites_shops_number
		and f.users_number = #{userNumber}
	</select>
	<!-- 가게 세부 -->
	<select id="detail" parameterType="shopsDTO">
		<!-- 가게 정보 -->
		s.select shops_number, s.shops_name, s.shops_biz_mid_category, s.shops_phone, s.shops_intro_text, s.shops_takeout, s.shops_files_number,
		<!-- 가게 편의 시설 여부 -->
		s.shops_floor_1f, s.shops_ramp, s.shops_entrance_step, s.shops_entrance_threshold, s.shops_toilet_step, s.shops_toilet_threshold, s.shops_disabled_toilet, s.shops_elevator, s.shops_parking, s.shops_disabled_parking,
		<!-- 위도 경도 -->
		s.shops_latitude, s.shops_longitude,
		<!-- 찜 여부 파악 -->
		case when f.favorites_number is not null then 'Y' else 'N' end as 'is_favorite',
		<!-- 가게 사진 -->
		f.shops_files_number, f.shops_files_type, f.shops_files_name, f.shops_files_path
		<!-- shops 테이블, favorite 테이블 조인 -->
		from tbl_shops s 
		left join tbl_shop_favorites f on s.shops_number = f.favorites_shops_number
		and f.users_number = #{userNumber}
		<!-- shops 테이블, files_shops 테이블 조인 -->
		from tbl_shops s 
		left join tbl_files_shops fs on s.shops_files_number = fs.shops_files_number
		where s.shops_number = #{shopsNumber}
	</select>
	<!-- 찜 추가 -->
	<insert id="favoriteAdd" >
		insert into tbl_shops_favorites
		values (seq_shops_favorites.nextval, #{userNumber}, #{shopsNumber}, sysdate)
	</insert>
	<!-- 찜 삭제 -->
	<delete id="favoriteDelete">
		delete from tbl_shops_favorites
		where users_number = #{usersNUmber} and favorites_shops_number = #{shopsNumber}
	</delete>
</mapper>


	


